{"version":3,"file":"index.js","sourceRoot":"","sources":["../../../src/web-component/ay-accordion-root/index.ts"],"names":[],"mappings":"AAAA,uCAAuC;AACvC;;;;;;;;;;;;;;;;;;;;GAoBG;AAEH,SAAS,GAAG,CAAE,EAAE,EAAE,SAAuB;IACvC,IAAI,IAAI,GAAG,SAAS,CAAC,OAAO,CAAC,mBAAmB,CAAgB,CAAC;IACjE,IAAI,eAAe,GAAG,KAAK,CAAC,SAAS,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,UAAU,EAAE,UAAS,EAAE;QAC5E,OAAO,EAAE,CAAC,QAAQ,KAAK,CAAC,CAAC;IAC3B,CAAC,CAAC,CAAC;IAEH,IAAI,OAAO,GAAG,IAAI,CAAC,qBAAqB,EAAE,CAAC;IAE3C,4BAA4B;IAC5B,IAAI,YAAY,GAAG,KAAK,CAAC,SAAS,CAAC,GAAG,CAAC,IAAI,CAAC,eAAe,EAAE,UAAS,EAAE;QACrE,OAAO;YACN,EAAE,EAAE,EAAE;YACN,iBAAiB,EAAG,EAAE,CAAC,qBAAqB,EAAE;YAC9C,gBAAgB,EAAI,EAAE,CAAC,KAAK,CAAC,SAAS,IAAI,EAAE;SAC5C,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,KAAK,CAAC,SAAS,GAAG,OAAO,CAAC,MAAM,GAAG,IAAI,CAAC;IAE7C,IAAG,CAAC,IAAI,CAAC,YAAY,CAAC,UAAU,CAAC,EAAE;QACjC,iCAAiC;QACjC,IAAI,CAAC,gBAAgB,CAAC,cAAc,CAAC,CAAC,OAAO,CAAC,CAAC,GAAG,EAAE,EAAE;YACpD,IAAG,GAAG,CAAC,YAAY,CAAC,MAAM,CAAC,IAAI,GAAG,IAAI,SAAS,EAAE;gBAC/C,GAAG,CAAC,eAAe,CAAC,MAAM,CAAC,CAAC;aAC7B;QACH,CAAC,CAAC,CAAC;KACJ;IAED,sCAAsC;IACtC,EAAE,EAAE,CAAC;IAEL,KAAK,CAAC,SAAS,CAAC,OAAO,CAAC,IAAI,CAAC,YAAY,EAAE,UAAS,CAAC;QACnD,CAAC,CAAC,aAAa,GAAG,CAAC,CAAC,EAAE,CAAC,qBAAqB,EAAE,CAAC;QAE/C,CAAC,CAAC,QAAQ,GAAG;YACX,CAAC,EAAE,CAAC,CAAC,iBAAiB,CAAC,KAAK,GAAG,CAAC,CAAC,aAAa,CAAC,KAAK;YACpD,CAAC,EAAE,CAAC,CAAC,iBAAiB,CAAC,MAAM,GAAG,CAAC,CAAC,aAAa,CAAC,MAAM;SACvD,CAAC;QAEF,CAAC,CAAC,SAAS,GAAG;YACZ,CAAC,EAAE,CAAC,CAAC,iBAAiB,CAAC,IAAI,GAAG,CAAC,CAAC,aAAa,CAAC,IAAI;YAClD,CAAC,EAAE,CAAC,CAAC,iBAAiB,CAAC,GAAG,GAAG,CAAC,CAAC,aAAa,CAAC,GAAG;SACjD,CAAC;QAEF,CAAC,CAAC,EAAE,CAAC,KAAK,CAAC,eAAe,GAAG,KAAK,CAAC;QACnC,CAAC,CAAC,EAAE,CAAC,KAAK,CAAC,UAAU,GAAG,WAAW,CAAA;QACnC,CAAC,CAAC,QAAQ,GAAG,EAAE,CAAC;QAEhB,iDAAiD;QACjD,IAAI,CAAC,CAAC,iBAAiB,CAAC,MAAM,KAAK,CAAC,CAAC,aAAa,CAAC,MAAM;YACvD,CAAC,CAAC,iBAAiB,CAAC,KAAK,KAAM,CAAC,CAAC,aAAa,CAAC,KAAK,EAAE;YAEtD,CAAC,CAAC,QAAQ,GAAG,KAAK,CAAC,SAAS,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,UAAU,EAAE,UAAS,EAAE;gBACnE,OAAO,EAAE,CAAC,QAAQ,KAAK,CAAC,CAAC;YAC3B,CAAC,CAAC,CAAC;YAEH,KAAK,CAAC,SAAS,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,QAAQ,EAAE,UAAS,EAAE;gBAClD,IAAI,YAAY,GAAG,EAAE,CAAC,qBAAqB,EAAE,CAAC;gBAC9C,IAAI,gBAAgB,GAAG;oBACrB,CAAC,EAAE,CAAC,CAAC,aAAa,CAAC,IAAI,GAAG,YAAY,CAAC,IAAI;oBAC3C,CAAC,EAAE,CAAC,CAAC,aAAa,CAAC,GAAG,GAAI,YAAY,CAAC,GAAG;iBAC3C,CAAC;gBAEF,IAAI,MAAM,GAAG,gBAAgB,CAAC,CAAC,GAAG,KAAK,CAAC;gBACxC,MAAM,IAAI,gBAAgB,CAAC,CAAC,GAAG,IAAI,CAAC;gBAEpC,EAAE,CAAC,KAAK,CAAC,eAAe,GAAG,MAAM,CAAC;gBAClC,EAAE,CAAC,KAAK,CAAC,UAAU,GAAG,WAAW,CAAA;YAEnC,CAAC,CAAC,CAAC;SACJ;IACH,CAAC,CAAC,CAAC;IAGH,IAAI,QAAQ,GAAG,GAAG,CAAC,CAAC,kBAAkB;IACtC,IAAI,CAAC,GAAG,CAAC,CAAC;IAEV,SAAS,KAAK;QACZ,KAAK,CAAC,SAAS,CAAC,OAAO,CAAC,IAAI,CAAC,YAAY,EAAE,UAAS,CAAC;YACnD,IAAI,CAAC,CAAC,iBAAiB,CAAC,MAAM,KAAK,CAAC,CAAC,aAAa,CAAC,MAAM;gBACrD,CAAC,CAAC,iBAAiB,CAAC,KAAK,KAAM,CAAC,CAAC,aAAa,CAAC,KAAK;gBACpD,CAAC,CAAC,iBAAiB,CAAC,IAAI,KAAO,CAAC,CAAC,aAAa,CAAC,IAAI;gBACnD,CAAC,CAAC,iBAAiB,CAAC,GAAG,KAAQ,CAAC,CAAC,aAAa,CAAC,GAAG,EAAE;gBACpD,OAAO;aACV;YAED,IAAI,OAAO,GAAK,CAAC,GAAG,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC,GAAG,CAAC,CAAC,GAAG,CAAC,CAAC;YAC3C,IAAI,OAAO,GAAK,CAAC,GAAG,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC,GAAG,CAAC,CAAC,GAAG,CAAC,CAAC;YAC3C,IAAI,QAAQ,GAAI,CAAC,CAAC,SAAS,CAAC,CAAC,GAAG,CAAC,CAAC;YAClC,IAAI,QAAQ,GAAI,CAAC,CAAC,SAAS,CAAC,CAAC,GAAG,CAAC,CAAC;YAElC,IAAI,SAAS,GAAG,YAAY,CAAC;YAC7B,SAAS,IAAI,QAAQ,GAAG,MAAM,CAAC;YAC/B,SAAS,IAAI,QAAQ,GAAG,MAAM,CAAC;YAC/B,SAAS,IAAI,QAAQ,GAAG,OAAO,GAAG,GAAG,GAAG,OAAO,GAAG,IAAI,CAAC;YACvD,SAAS,IAAI,CAAC,CAAC,gBAAgB,CAAC;YAEhC,CAAC,CAAC,EAAE,CAAC,KAAK,CAAC,SAAS,GAAG,SAAS,CAAC;YAEjC,KAAK,CAAC,SAAS,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,QAAQ,EAAE,UAAS,EAAE;gBAClD,IAAI,KAAK,GAAG,QAAQ,GAAG,CAAC,CAAC,GAAC,OAAO,CAAC,GAAG,GAAG,GAAG,CAAC,CAAC,GAAC,OAAO,CAAC,GAAG,GAAG,CAAC;gBAC7D,EAAE,CAAC,KAAK,CAAC,SAAS,GAAG,KAAK,CAAC;YAC7B,CAAC,CAAC,CAAC;QACL,CAAC,CAAC,CAAC;QAEH,CAAC,IAAI,CAAC,EAAE,GAAG,QAAQ,CAAC,CAAC;QAErB,IAAI,CAAC,GAAG,CAAC,EAAE;YACT,qBAAqB,CAAC,KAAK,CAAC,CAAC;SAC9B;aAAM;YACL,OAAO,EAAE,CAAC;SACX;IACH,CAAC;IAED,KAAK,EAAE,CAAC;IAER,SAAS,OAAO;QACd,KAAK,CAAC,SAAS,CAAC,OAAO,CAAC,IAAI,CAAC,YAAY,EAAE,UAAS,CAAC;YACnD,CAAC,CAAC,EAAE,CAAC,KAAK,CAAC,eAAe,GAAG,EAAE,CAAC;YAChC,CAAC,CAAC,EAAE,CAAC,KAAK,CAAC,SAAS,GAAG,CAAC,CAAC,gBAAgB,CAAC;YAC1C,CAAC,CAAC,EAAE,CAAC,KAAK,CAAC,UAAU,GAAG,EAAE,CAAA;YAE1B,KAAK,CAAC,SAAS,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,QAAQ,EAAE,UAAS,EAAE;gBAClD,EAAE,CAAC,KAAK,CAAC,eAAe,GAAG,EAAE,CAAC;gBAC9B,EAAE,CAAC,KAAK,CAAC,SAAS,GAAG,EAAE,CAAC;gBACxB,EAAE,CAAC,KAAK,CAAC,UAAU,GAAG,EAAE,CAAA;YAC1B,CAAC,CAAC,CAAC;QACL,CAAC,CAAC,CAAC;QAEH,IAAI,CAAC,KAAK,CAAC,SAAS,GAAG,IAAI,CAAC;QAE5B,IAAI,aAAa,GAAG,QAAQ,CAAC,kBAAkB,CAAC,IAAI,QAAQ,CAAC,IAAI,CAAC;QAClE,IAAI,UAAU,GAAG,aAAa,CAAC,SAAS,GAAG,aAAa,CAAC,YAAY,CAAC;QACtE,IAAI,SAAS,GAAG,YAAY,CAAC,GAAG,EAAE,CAAC;QACnC,IAAI,SAAS,CAAC,iBAAiB,CAAC,MAAM,KAAK,SAAS,CAAC,aAAa,CAAC,MAAM,IAAI,CAAC,UAAU,GAAG,SAAS,CAAC,iBAAiB,CAAC,MAAM,GAAG,SAAS,CAAC,iBAAiB,CAAC,MAAM,CAAC,EAAE;YACnK,MAAM,CAAC,QAAQ,CAAC,CAAC,EAAE,CAAC,SAAS,CAAC,aAAa,CAAC,MAAM,GAAG,SAAS,CAAC,iBAAiB,CAAC,MAAM,CAAC,CAAC,CAAC;SAC3F;IACH,CAAC;AAEH,CAAC;AAED,MAAM,OAAO,eAAgB,SAAQ,WAAW;CAE/C;AAED,IAAI,MAAM,CAAC,cAAc,EAAE;IACzB,cAAc,CAAC,MAAM,CAAC,mBAAmB,EAAE,eAAe,CAAC,CAAC;CAC7D;AAED,OAAO,EAAE,GAAG,EAAE,CAAA","sourcesContent":["/*! Copyright 2019 Ayogo Health Inc. */\n/**\n * ay-accordion-root is a web-component which wraps the ay-accordion elements as its children.\n *\n * ay-accordion-root can take on the following attributes\n * multiple: This attribute allows multiple accordion sections to be open at the same time (default is only a single section expanded at a time).\n *\n * For example:\n * ```\n * <ay-accordion-root>\n *  <ay-accordion>\n *   <ay-accordion-header>\n *     Button Name\n *    </ay-accordion-header>\n *    <p> Some content </p>\n *  </ay-accordion>\n * </ay-accordion-root>\n * ```\n *\n * @name ay-accordion-root\n *\n */\n\nfunction run (fn, accordion : HTMLElement) {\n  let root = accordion.closest('ay-accordion-root') as HTMLElement;\n  let elementsToWatch = Array.prototype.filter.call(root.childNodes, function(el) {\n    return el.nodeType === 1;\n  });\n\n  let preRoot = root.getBoundingClientRect();\n\n  // Take initial measurements\n  let measurements = Array.prototype.map.call(elementsToWatch, function(el) {\n     return {\n      el: el,\n      initialDimensions:  el.getBoundingClientRect(),\n      initialTransform:   el.style.transform || ''\n     };\n  });\n\n  root.style.minHeight = preRoot.height + 'px';\n\n  if(!root.hasAttribute('multiple')) {\n    //Close existing panels if needed\n    root.querySelectorAll('ay-accordion').forEach((acc) => {\n      if(acc.hasAttribute('open') && acc != accordion) {\n        acc.removeAttribute('open');\n      }\n    });\n  }\n\n  //Run the function to chaneg the state\n  fn();\n\n  Array.prototype.forEach.call(measurements, function(m) {\n    m.newDimensions = m.el.getBoundingClientRect();\n\n    m.newScale = {\n      x: m.initialDimensions.width / m.newDimensions.width,\n      y: m.initialDimensions.height / m.newDimensions.height\n    };\n\n    m.newOffset = {\n      x: m.initialDimensions.left - m.newDimensions.left,\n      y: m.initialDimensions.top - m.newDimensions.top\n    };\n\n    m.el.style.transformOrigin = \"0 0\";\n    m.el.style.willChange = 'transform'\n    m.children = [];\n\n    // Set the grandchildren to the inverse transform\n    if (m.initialDimensions.height !== m.newDimensions.height ||\n      m.initialDimensions.width  !== m.newDimensions.width) {\n\n      m.children = Array.prototype.filter.call(m.el.childNodes, function(el) {\n        return el.nodeType === 1;\n      });\n\n      Array.prototype.forEach.call(m.children, function(el) {\n        var elDimensions = el.getBoundingClientRect();\n        var offsetFromParent = {\n          x: m.newDimensions.left - elDimensions.left,\n          y: m.newDimensions.top  - elDimensions.top\n        };\n\n        var origin = offsetFromParent.x + 'px ';\n        origin += offsetFromParent.y + 'px';\n\n        el.style.transformOrigin = origin;\n        el.style.willChange = 'transform'\n\n      });\n    }\n  });\n\n\n  var duration = 100; // In milliseconds\n  var t = 1;\n\n  function tween() {\n    Array.prototype.forEach.call(measurements, function(m) {\n      if (m.initialDimensions.height === m.newDimensions.height &&\n          m.initialDimensions.width  === m.newDimensions.width  &&\n          m.initialDimensions.left   === m.newDimensions.left   &&\n          m.initialDimensions.top    === m.newDimensions.top) {\n          return;\n      }\n\n      var tScaleX   = 1 + (m.newScale.x - 1) * t;\n      var tScaleY   = 1 + (m.newScale.y - 1) * t;\n      var tOffsetX  = m.newOffset.x * t;\n      var tOffsetY  = m.newOffset.y * t;\n\n      var transform = 'translate(';\n      transform += tOffsetX + 'px, ';\n      transform += tOffsetY + 'px) ';\n      transform += 'scale(' + tScaleX + ',' + tScaleY + ') ';\n      transform += m.initialTransform;\n\n      m.el.style.transform = transform;\n\n      Array.prototype.forEach.call(m.children, function(el) {\n        var scale = 'scale(' + (1/tScaleX) + ',' + (1/tScaleY) + ')';\n        el.style.transform = scale;\n      });\n    });\n\n    t -= (16 / duration);\n\n    if (t > 0) {\n      requestAnimationFrame(tween);\n    } else {\n      cleanup();\n    }\n  }\n\n  tween();\n\n  function cleanup() {\n    Array.prototype.forEach.call(measurements, function(m) {\n      m.el.style.transformOrigin = '';\n      m.el.style.transform = m.initialTransform;\n      m.el.style.willChange = ''\n\n      Array.prototype.forEach.call(m.children, function(el) {\n        el.style.transformOrigin = '';\n        el.style.transform = '';\n        el.style.willChange = ''\n      });\n    });\n\n    root.style.minHeight = null;\n\n    var scrollingRoot = document['scrollingElement'] || document.body;\n    var pageBottom = scrollingRoot.scrollTop + scrollingRoot.clientHeight;\n    var lastChild = measurements.pop();\n    if (lastChild.initialDimensions.height !== lastChild.newDimensions.height && (pageBottom - lastChild.initialDimensions.bottom < lastChild.initialDimensions.height)) {\n      window.scrollBy(0, (lastChild.newDimensions.height - lastChild.initialDimensions.height));\n    }\n  }\n\n}\n\nexport class AyAccordionRoot extends HTMLElement {\n\n}\n\nif (window.customElements) {\n  customElements.define('ay-accordion-root', AyAccordionRoot);\n}\n\nexport { run }\n"]}